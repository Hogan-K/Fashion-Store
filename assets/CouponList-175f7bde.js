import{_ as D,b8 as w,al as f,m as r,n as m,v as a,q as l,w as n,af as C,X as p,x as y,t as i,ar as F,as as g,y as L,z as U}from"./index-23bea264.js";import{V as M}from"./VHover-4a9a9a9d.js";import{V as N}from"./VTable-fe1e12db.js";import{V as j}from"./VPagination-c6456907.js";import{V}from"./VDialog-102397b9.js";import{b,c as v,d as x,V as _,e as k}from"./VTextField-6f1d51e2.js";import{V as I}from"./VCheckbox-c970dea3.js";import{V as P}from"./VDivider-1c5b49b8.js";import"./forwardRefs-7e4c9562.js";import"./dialog-transition-886bed5a.js";import"./VAvatar-031cb68e.js";import"./form-10e282b3.js";import"./VCheckboxBtn-943948f6.js";const O={name:"COUPONLIST",data(){return{dialog:!1,dialogDel:!1,coupons:{},tempCoupon:{title:"",is_enabled:0,percent:"",due_date:"",code:""},due_date:"",page:1,totalPage:0}},watch:{due_date(){let e=this,t=w(e.due_date).valueOf();e.tempCoupon.due_date=t},page(){let e=this;e.getCoupons(e.page)}},methods:{getCoupons(e){let t=this;t.$store.dispatch("Loading",!0),f.get(`https://vue-course-api.hexschool.io/api/hogankai/admin/coupons?page=${e}`).then(d=>{t.coupons=d.data.coupons,t.totalPage=d.data.pagination.total_pages,t.$store.dispatch("Loading",!1),console.log(d.data)})},openModal(e,t){let d=this;d.dialog=!0,d.isNew=e,d.isNew?d.tempCoupon={}:d.tempCoupon=Object.assign({},t)},updateCoupon(){let e=this;e.$store.dispatch("Loading",!0),e.tempCoupon.is_enabled==0&&(e.tempCoupon.code=null),e.isNew?f.post("https://vue-course-api.hexschool.io/api/hogankai/admin/coupon",{data:e.tempCoupon}).then(()=>{e.dialog=!1,e.getCoupons(e.page),e.$store.dispatch("Loading",!1)}):f.put(`https://vue-course-api.hexschool.io/api/hogankai/admin/coupon/${e.tempCoupon.id}`,{data:e.tempCoupon}).then(()=>{e.dialog=!1,e.getCoupons(e.page),e.$store.dispatch("Loading",!1)})},cancelModal(){this.dialog=!1,this.dialogDel=!1},openDel(e){let t=this;t.tempCoupon=Object.assign({},e),t.dialogDel=!0},DelCoupon(){let e=this;e.$store.dispatch("Loading",!0),f.delete(`https://vue-course-api.hexschool.io/api/hogankai/admin/coupon/${e.tempCoupon.id}`).then(()=>{e.dialogDel=!1,e.getCoupons(e.page),e.$store.dispatch("Loading",!1)})}},created(){this.getCoupons()}},c=e=>(L("data-v-d71e122f"),e=e(),U(),e),S={class:"text-end mt-4"},T=c(()=>a("thead",null,[a("tr",null,[a("th",{class:"text-subtitle-1 font-weight-bold"},"優惠券名稱"),a("th",{class:"d-none d-sm-table-cell text-subtitle-1 font-weight-bold"},"折扣％數"),a("th",{class:"text-subtitle-1 font-weight-bold"},"到期日"),a("th",{class:"d-none d-sm-table-cell text-subtitle-1 font-weight-bold"},"是否啟用"),a("th",{class:"text-subtitle-1 font-weight-bold"},"編輯"),a("th",{class:"text-subtitle-1 font-weight-bold"},"刪除")])],-1)),B={class:"text-8F8681"},Y={class:"d-none d-sm-table-cell text-8F8681"},R={class:"text-8F8681"},W={class:"d-none d-sm-table-cell bgF5F"},q={key:0,class:"text-success"},z={key:1,class:"text-grey-darken-1"},A={class:"bgF5F"},E={class:"bgF5F"},H=c(()=>a("i",{class:"far fa-trash-alt"},null,-1)),X={class:"text-center"},G=c(()=>a("h4",null,"名稱",-1)),J=c(()=>a("h4",null,"優惠碼",-1)),K=c(()=>a("h4",null,"到期日",-1)),Q=c(()=>a("h4",null,"折扣％數",-1)),Z={class:"text-red"};function $(e,t,d,ee,s,u){return r(),m(C,null,[a("div",S,[l(M,null,{default:n(({isHovering:o,props:h})=>[l(p,y({class:"mr-4 text-8F8681",variant:"outlined"},h,{elevation:o?2:8,onClick:t[0]||(t[0]=te=>u.openModal(!0))}),{default:n(()=>[i(" 建立新的優惠券 ")]),_:2},1040,["elevation"])]),_:1})]),l(N,{class:"table mt-4 bg-brown-lighten-5"},{default:n(()=>[T,a("tbody",null,[(r(!0),m(C,null,F(s.coupons,o=>(r(),m("tr",{key:o.id},[a("td",B,g(o.title),1),a("td",Y,g(o.percent),1),a("td",R,g(e.$dayjs(o.due_date).format("YYYY-MM-DD")),1),a("td",W,[o.is_enabled?(r(),m("span",q,"啟用")):(r(),m("span",z,"未啟用"))]),a("td",A,[l(p,{variant:"outlined",color:"blue",onClick:h=>u.openModal(!1,o)},{default:n(()=>[i("編輯")]),_:2},1032,["onClick"])]),a("td",E,[l(p,{variant:"outlined",color:"red",onClick:h=>u.openDel(o)},{default:n(()=>[H]),_:2},1032,["onClick"])])]))),128))])]),_:1}),a("div",X,[l(j,{class:"my-4",modelValue:s.page,"onUpdate:modelValue":t[1]||(t[1]=o=>s.page=o),length:s.totalPage,"total-visible":5},null,8,["modelValue","length"])]),l(V,{modelValue:s.dialog,"onUpdate:modelValue":t[7]||(t[7]=o=>s.dialog=o)},{default:n(()=>[l(b,{class:"mx-auto RWDcard"},{default:n(()=>[l(v,{class:"bg-a67f78 text-white"},{default:n(()=>[i("新增優惠券")]),_:1}),l(x,null,{default:n(()=>[G,l(_,{label:"請輸入優惠券名稱",variant:"solo-filled",class:"mt-2",modelValue:s.tempCoupon.title,"onUpdate:modelValue":t[2]||(t[2]=o=>s.tempCoupon.title=o)},null,8,["modelValue"]),J,l(_,{label:"請輸入優惠碼",variant:"solo-filled",class:"mt-2",modelValue:s.tempCoupon.code,"onUpdate:modelValue":t[3]||(t[3]=o=>s.tempCoupon.code=o)},null,8,["modelValue"]),K,l(_,{type:"date",label:"請輸入到期日",variant:"solo-filled",class:"mt-2",modelValue:s.due_date,"onUpdate:modelValue":t[4]||(t[4]=o=>s.due_date=o)},null,8,["modelValue"]),Q,l(_,{label:"請輸入折扣％數",variant:"solo-filled",class:"mt-2",modelValue:s.tempCoupon.percent,"onUpdate:modelValue":t[5]||(t[5]=o=>s.tempCoupon.percent=o)},null,8,["modelValue"]),l(I,{label:"是否啟用",modelValue:s.tempCoupon.is_enabled,"onUpdate:modelValue":t[6]||(t[6]=o=>s.tempCoupon.is_enabled=o),"true-value":1,"false-value":0},null,8,["modelValue"])]),_:1}),l(k,{class:"d-flex justify-end"},{default:n(()=>[l(p,{class:"ma-4",variant:"outlined",onClick:u.cancelModal},{default:n(()=>[i("取消")]),_:1},8,["onClick"]),l(p,{class:"ma-4",variant:"outlined",onClick:u.updateCoupon},{default:n(()=>[i("確定")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(V,{modelValue:s.dialogDel,"onUpdate:modelValue":t[8]||(t[8]=o=>s.dialogDel=o)},{default:n(()=>[l(b,{class:"mx-auto RWDdialogDel"},{default:n(()=>[l(v,{class:"bg-a67f78 text-white"},{default:n(()=>[i("刪除優惠券")]),_:1}),l(x,null,{default:n(()=>[i(" 是否刪除 "),a("span",Z,g(s.tempCoupon.title),1),i(" 優惠券 ( 刪除後將無法恢復 ) ")]),_:1}),l(P,{class:"my-4"}),l(k,{class:"justify-end"},{default:n(()=>[l(p,{variant:"outlined",onClick:u.cancelModal},{default:n(()=>[i("取消")]),_:1},8,["onClick"]),l(p,{variant:"outlined",onClick:u.DelCoupon},{default:n(()=>[i("確定")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const ge=D(O,[["render",$],["__scopeId","data-v-d71e122f"]]);export{ge as default};
